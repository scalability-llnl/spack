spack:
  view: false
  packages:
    all:
      require: target=power64le
      variants: ~cuda~rocm
    pkgconfig:
      require: pkgconf
    pil:
      require: py-pillow
    mpi:
      require: openmpi
    python:
      require: "+libxml2"
    py-pybind11:
      require: "build_system=cmake"
    py-keras-applications:
      require: "build_system=python_pip"
    curl:
      require: "tls=gnutls"
    py-pytorch-gradual-warmup-lr:
      require: "build_system=python_pip"
    py-pytorch-lightning:
      require: "build_system=python_pip"
    jpeg:
      require: "libjpeg-turbo"
    py-torch-cluster:
      require: "~cuda"
    py-torch-geometric:
      require: "~cuda"
    py-torch-scatter:
      require: "~cuda"
    py-torch-spline-conv:
      require: "~cuda"
    py-torchaudio:
      require: "build_system=python_pip"
    py-torchfile:
      require: "build_system=python_pip"
    py-torchvision:
      require: "build_system=python_pip"
    py-numpy:
      require: "build_system=python_pip"
    py-tensorboard-data-server:
      require: "build_system=python_pip"
    py-tensorboard-plugin-wit:
      require: "build_system=python_pip"
    swig:
      require: "@4.1.1"
    xgboost:
      require: "generator=ninja"

  specs:
    # Horovod
    - py-horovod~tensor_ops controllers=mpi frameworks=pytorch

    # Hugging Face
    - py-transformers

    # JAX
    - py-jax
    - py-jaxlib

    # Keras
    - py-keras
    - py-keras-applications
    - py-keras-preprocessing
    - py-keras2onnx

    # MXNet
    - mxnet

    # PyTorch
    - py-botorch
    - py-efficientnet-pytorch
    - py-gpytorch
    - py-kornia
    - py-lightning
    - py-pytorch-gradual-warmup-lr
    - py-pytorch-lightning
    - py-segmentation-models-pytorch
    - py-timm
    - py-torch
    - py-torch-cluster
    - py-torch-geometric
    - py-torch-nvidia-apex
    - py-torch-scatter
    - py-torch-sparse
    - py-torch-spline-conv
    - py-torchaudio
    - py-torchdata
    - py-torchfile
    - py-torchgeo
    - py-torchmetrics
    - py-torchtext
    - py-torchvision
    - py-vector-quantize-pytorch

    # scikit-learn
    - py-scikit-learn
    - py-scikit-learn-extra

    # TensorBoard
    - py-tensorboard
    - py-tensorboard-data-server
    - py-tensorboard-plugin-wit
    - py-tensorboardx

    # TensorFlow
    - py-tensorflow
    - py-tensorflow-datasets
    - py-tensorflow-estimator
    - py-tensorflow-hub
    - py-tensorflow-metadata
    - py-tensorflow-probability

    # XGBoost
    - py-xgboost
    # - r-xgboost
    - xgboost

  mirrors:
    mirror: s3://spack-binaries/develop/ml-linux-power64le-cpu

  ci:
    pipeline-gen:
    - build-job:
        image:
          name: ecpe4s/ubuntu20.04-runner-ppc64le:2023-01-01
          entrypoint: ['']
    - build-job:
        image:
          name: ecpe4s/fedora36-runner-ppc64le:2023-01-01
          entrypoint: ['']

  cdash:
    build-group: Machine Learning
