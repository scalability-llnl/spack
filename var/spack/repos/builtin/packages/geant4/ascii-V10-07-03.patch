From 872da1ec107bee9ed2a3ce00000494dc9cb08c39 Mon Sep 17 00:00:00 2001
From: Gabriele Cosmo <Gabriele.Cosmo@cern.ch>
Date: Tue, 16 Nov 2021 08:32:17 +0100
Subject: [PATCH] ascii-V10-07-03: Addressing problem report 2444

---
 source/persistency/ascii/History              |  5 ++
 .../persistency/ascii/src/G4tgrEvaluator.cc   | 72 +++++++++----------
 2 files changed, 41 insertions(+), 36 deletions(-)

diff --git a/source/persistency/ascii/History b/source/persistency/ascii/History
index 007f6288767..8665bdc9bb4 100644
--- a/source/persistency/ascii/History
+++ b/source/persistency/ascii/History
@@ -15,6 +15,11 @@ committal in the CVS repository !
      * Reverse chronological order (last date on top), please *
      ----------------------------------------------------------
 
+16 November 2021 - G. Cosmo (ascii-V10-07-03)
+- Change prefix to free math functions in G4tgrEvaluator source, to avoid
+  potential clashes with system functions carrying same name and signature.
+  Addressing problem report #2444.
+
 9 July 2021 - V. Ivanchenko (ascii-V10-07-02)
 - G4tgbGeometryDumper - fixed access to G4Elements
 
diff --git a/source/persistency/ascii/src/G4tgrEvaluator.cc b/source/persistency/ascii/src/G4tgrEvaluator.cc
index 3e0e7de7a85..54897038a7d 100644
--- a/source/persistency/ascii/src/G4tgrEvaluator.cc
+++ b/source/persistency/ascii/src/G4tgrEvaluator.cc
@@ -57,44 +57,44 @@ void G4tgrEvaluator::print_error(G4int estatus) const
   }
 }
 
-G4double fsin(G4double arg) { return std::sin(arg); }
-G4double fcos(G4double arg) { return std::cos(arg); }
-G4double ftan(G4double arg) { return std::tan(arg); }
-G4double fasin(G4double arg) { return std::asin(arg); }
-G4double facos(G4double arg) { return std::acos(arg); }
-G4double fatan(G4double arg) { return std::atan(arg); }
-G4double fatan2(G4double arg1, G4double arg2) { return std::atan2(arg1, arg2); }
-G4double fsinh(G4double arg) { return std::sinh(arg); }
-G4double fcosh(G4double arg) { return std::cosh(arg); }
-G4double ftanh(G4double arg) { return std::tanh(arg); }
-// G4double fasinh( G4double arg ){  return std::asinh(arg); }
-// G4double facosh( G4double arg ){  return std::acosh(arg); }
-// G4double fatanh( G4double arg ){  return std::atanh(arg); }
-G4double fsqrt(G4double arg) { return std::sqrt(arg); }
-G4double fexp(G4double arg) { return std::exp(arg); }
-G4double flog(G4double arg) { return std::log(arg); }
-G4double flog10(G4double arg) { return std::log10(arg); }
-G4double fpow(G4double arg1, G4double arg2) { return std::pow(arg1, arg2); }
+G4double fltsin(G4double arg) { return std::sin(arg); }
+G4double fltcos(G4double arg) { return std::cos(arg); }
+G4double flttan(G4double arg) { return std::tan(arg); }
+G4double fltasin(G4double arg) { return std::asin(arg); }
+G4double fltacos(G4double arg) { return std::acos(arg); }
+G4double fltatan(G4double arg) { return std::atan(arg); }
+G4double fltatan2(G4double arg1, G4double arg2) { return std::atan2(arg1, arg2); }
+G4double fltsinh(G4double arg) { return std::sinh(arg); }
+G4double fltcosh(G4double arg) { return std::cosh(arg); }
+G4double flttanh(G4double arg) { return std::tanh(arg); }
+// G4double fltasinh( G4double arg ){  return std::asinh(arg); }
+// G4double fltacosh( G4double arg ){  return std::acosh(arg); }
+// G4double fltatanh( G4double arg ){  return std::atanh(arg); }
+G4double fltsqrt(G4double arg) { return std::sqrt(arg); }
+G4double fltexp(G4double arg) { return std::exp(arg); }
+G4double fltlog(G4double arg) { return std::log(arg); }
+G4double fltlog10(G4double arg) { return std::log10(arg); }
+G4double fltpow(G4double arg1, G4double arg2) { return std::pow(arg1, arg2); }
 
 // --------------------------------------------------------------------
 void G4tgrEvaluator::AddCommonFunctions()
 {
-  setFunction("sin", (*fsin));
-  setFunction("cos", (*fcos));
-  setFunction("tan", (*ftan));
-  setFunction("asin", (*fasin));
-  setFunction("acos", (*facos));
-  setFunction("atan", (*fatan));
-  setFunction("atan2", (*fatan2));
-  setFunction("sinh", (*fsinh));
-  setFunction("cosh", (*fcosh));
-  setFunction("tanh", (*ftanh));
-  //  setFunction("asinh", (*fasinh));
-  //  setFunction("acosh", (*facosh));
-  //  setFunction("atanh", (*fatanh));
-  setFunction("sqrt", (*fsqrt));
-  setFunction("exp", (*fexp));
-  setFunction("log", (*flog));
-  setFunction("log10", (*flog10));
-  setFunction("pow", (*fpow));
+  setFunction("sin", (*fltsin));
+  setFunction("cos", (*fltcos));
+  setFunction("tan", (*flttan));
+  setFunction("asin", (*fltasin));
+  setFunction("acos", (*fltacos));
+  setFunction("atan", (*fltatan));
+  setFunction("atan2", (*fltatan2));
+  setFunction("sinh", (*fltsinh));
+  setFunction("cosh", (*fltcosh));
+  setFunction("tanh", (*flttanh));
+  //  setFunction("asinh", (*fltasinh));
+  //  setFunction("acosh", (*fltacosh));
+  //  setFunction("atanh", (*fltatanh));
+  setFunction("sqrt", (*fltsqrt));
+  setFunction("exp", (*fltexp));
+  setFunction("log", (*fltlog));
+  setFunction("log10", (*fltlog10));
+  setFunction("pow", (*fltpow));
 }
-- 
2.43.0

